const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./assets/xtermModule-CsJ4vdCR.js","./xtermModule.DYP7pi_n.css"])))=>i.map(i=>d[i]);
import{u as zt,r as H,g as Kt,_ as Vt,h as $t,i as Ht,j as n,R as d,E as qt,s as yt,k as mt,l as Yt,t as Qt,m as Xt,n as q,o as F,T as Et,c as Jt,p as at,a as Zt,W as Gt,S as te,q as ee,b as se,e as ie,f as oe}from"./assets/defaultSettingsView-Dlnhdtv5.js";var ne={};class pt{constructor(t,e={}){this.isListing=!1,this._tests=new Map,this._rootSuite=new Z("","root"),this._options=e,this._reporter=t}reset(){this._rootSuite._entries=[],this._tests.clear()}dispatch(t){const{method:e,params:s}=t;if(e==="onConfigure"){this._onConfigure(s.config);return}if(e==="onProject"){this._onProject(s.project);return}if(e==="onBegin"){this._onBegin();return}if(e==="onTestBegin"){this._onTestBegin(s.testId,s.result);return}if(e==="onTestPaused"){this._onTestPaused(s.testId,s.resultId,s.errors);return}if(e==="onTestEnd"){this._onTestEnd(s.test,s.result);return}if(e==="onStepBegin"){this._onStepBegin(s.testId,s.resultId,s.step);return}if(e==="onAttach"){this._onAttach(s.testId,s.resultId,s.attachments);return}if(e==="onStepEnd"){this._onStepEnd(s.testId,s.resultId,s.step);return}if(e==="onError"){this._onError(s.error);return}if(e==="onStdIO"){this._onStdIO(s.type,s.testId,s.resultId,s.data,s.isBase64);return}if(e==="onEnd")return this._onEnd(s.result);if(e==="onExit")return this._onExit()}_onConfigure(t){var e,s;this._rootDir=t.rootDir,this._config=this._parseConfig(t),(s=(e=this._reporter).onConfigure)==null||s.call(e,this._config)}_onProject(t){let e=this._options.mergeProjects?this._rootSuite.suites.find(a=>a.project().name===t.name):void 0;e||(e=new Z(t.name,"project"),this._rootSuite._addSuite(e));const s=this._parseProject(t);e._project=s;let i=-1;this._options.mergeProjects&&(i=this._config.projects.findIndex(a=>a.name===t.name)),i===-1?this._config.projects.push(s):this._config.projects[i]=s;for(const a of t.suites)this._mergeSuiteInto(a,e)}_onBegin(){var t,e;(e=(t=this._reporter).onBegin)==null||e.call(t,this._rootSuite)}_onTestBegin(t,e){var a,r;const s=this._tests.get(t);this._options.clearPreviousResultsWhenTestBegins&&(s.results=[]);const i=s._createTestResult(e.id);i.retry=e.retry,i.workerIndex=e.workerIndex,i.parallelIndex=e.parallelIndex,i.setStartTimeNumber(e.startTime),(r=(a=this._reporter).onTestBegin)==null||r.call(a,s,i)}_onTestPaused(t,e,s){var r,m;const i=this._tests.get(t),a=i.results.find(u=>u._id===e);a.errors.push(...s),a.error=a.errors[0],(m=(r=this._reporter).onTestPaused)==null||m.call(r,i,a)}_onTestEnd(t,e){var a,r;const s=this._tests.get(t.testId);s.timeout=t.timeout,s.expectedStatus=t.expectedStatus;const i=s.results.find(m=>m._id===e.id);i.duration=e.duration,i.status=e.status,i.errors.push(...e.errors??[]),i.error=i.errors[0],e.attachments&&(i.attachments=this._parseAttachments(e.attachments)),e.annotations&&(this._absoluteAnnotationLocationsInplace(e.annotations),i.annotations=e.annotations,s.annotations=e.annotations),(r=(a=this._reporter).onTestEnd)==null||r.call(a,s,i),i._stepMap=new Map}_onStepBegin(t,e,s){var f,l;const i=this._tests.get(t),a=i.results.find(w=>w._id===e),r=s.parentStepId?a._stepMap.get(s.parentStepId):void 0,m=this._absoluteLocation(s.location),u=new ae(s,r,m,a);r?r.steps.push(u):a.steps.push(u),a._stepMap.set(s.id,u),(l=(f=this._reporter).onStepBegin)==null||l.call(f,i,a,u)}_onStepEnd(t,e,s){var m,u;const i=this._tests.get(t),a=i.results.find(f=>f._id===e),r=a._stepMap.get(s.id);r._endPayload=s,r.duration=s.duration,r.error=s.error,(u=(m=this._reporter).onStepEnd)==null||u.call(m,i,a,r)}_onAttach(t,e,s){this._tests.get(t).results.find(r=>r._id===e).attachments.push(...s.map(r=>({name:r.name,contentType:r.contentType,path:r.path,body:r.base64&&globalThis.Buffer?Buffer.from(r.base64,"base64"):void 0})))}_onError(t){var e,s;(s=(e=this._reporter).onError)==null||s.call(e,t)}_onStdIO(t,e,s,i,a){var f,l,w,x;const r=a?globalThis.Buffer?Buffer.from(i,"base64"):atob(i):i,m=e?this._tests.get(e):void 0,u=m&&s?m.results.find(c=>c._id===s):void 0;t==="stdout"?(u==null||u.stdout.push(r),(l=(f=this._reporter).onStdOut)==null||l.call(f,r,m,u)):(u==null||u.stderr.push(r),(x=(w=this._reporter).onStdErr)==null||x.call(w,r,m,u))}async _onEnd(t){var e,s;await((s=(e=this._reporter).onEnd)==null?void 0:s.call(e,de(t)))}_onExit(){var t,e;return(e=(t=this._reporter).onExit)==null?void 0:e.call(t)}_parseConfig(t){const e=he(t);return this._options.configOverrides&&(e.configFile=this._options.configOverrides.configFile,e.reportSlowTests=this._options.configOverrides.reportSlowTests,e.quiet=this._options.configOverrides.quiet,e.reporter=[...this._options.configOverrides.reporter]),e}_parseProject(t){return{metadata:t.metadata,name:t.name,outputDir:this._absolutePath(t.outputDir),repeatEach:t.repeatEach,retries:t.retries,testDir:this._absolutePath(t.testDir),testIgnore:lt(t.testIgnore),testMatch:lt(t.testMatch),timeout:t.timeout,grep:lt(t.grep),grepInvert:lt(t.grepInvert),dependencies:t.dependencies,teardown:t.teardown,snapshotDir:this._absolutePath(t.snapshotDir),ignoreSnapshots:t.ignoreSnapshots??!1,use:t.use}}_parseAttachments(t){return t.map(e=>({...e,body:e.base64&&globalThis.Buffer?Buffer.from(e.base64,"base64"):void 0}))}_mergeSuiteInto(t,e){let s=e.suites.find(i=>i.title===t.title);s||(s=new Z(t.title,e.type==="project"?"file":"describe"),e._addSuite(s)),s.location=this._absoluteLocation(t.location),t.entries.forEach(i=>{"testId"in i?this._mergeTestInto(i,s):this._mergeSuiteInto(i,s)})}_mergeTestInto(t,e){let s=this._options.mergeTestCases?e.tests.find(i=>i.title===t.title&&i.repeatEachIndex===t.repeatEachIndex):void 0;s||(s=new re(t.testId,t.title,this._absoluteLocation(t.location),t.repeatEachIndex),e._addTest(s),this._tests.set(s.id,s)),this._updateTest(t,s)}_updateTest(t,e){return e.id=t.testId,e.location=this._absoluteLocation(t.location),e.retries=t.retries,e.tags=t.tags??[],e.annotations=t.annotations??[],this._absoluteAnnotationLocationsInplace(e.annotations),e}_absoluteAnnotationLocationsInplace(t){for(const e of t)e.location&&(e.location=this._absoluteLocation(e.location))}_absoluteLocation(t){return t&&{...t,file:this._absolutePath(t.file)}}_absolutePath(t){if(t!==void 0)return this._options.resolvePath?this._options.resolvePath(this._rootDir,t):this._rootDir+"/"+t}}class Z{constructor(t,e){this._entries=[],this._requireFile="",this._parallelMode="none",this.title=t,this._type=e}get type(){return this._type}get suites(){return this._entries.filter(t=>t.type!=="test")}get tests(){return this._entries.filter(t=>t.type==="test")}entries(){return this._entries}allTests(){const t=[],e=s=>{for(const i of s.entries())i.type==="test"?t.push(i):e(i)};return e(this),t}titlePath(){const t=this.parent?this.parent.titlePath():[];return(this.title||this._type!=="describe")&&t.push(this.title),t}project(){var t;return this._project??((t=this.parent)==null?void 0:t.project())}_addTest(t){t.parent=this,this._entries.push(t)}_addSuite(t){t.parent=this,this._entries.push(t)}}class re{constructor(t,e,s,i){this.fn=()=>{},this.results=[],this.type="test",this.expectedStatus="passed",this.timeout=0,this.annotations=[],this.retries=0,this.tags=[],this.repeatEachIndex=0,this.id=t,this.title=e,this.location=s,this.repeatEachIndex=i}titlePath(){const t=this.parent?this.parent.titlePath():[];return t.push(this.title),t}outcome(){return ue(this)}ok(){const t=this.outcome();return t==="expected"||t==="flaky"||t==="skipped"}_createTestResult(t){const e=new le(this.results.length,t);return this.results.push(e),e}}class ae{constructor(t,e,s,i){this.duration=-1,this.steps=[],this._startTime=0,this.title=t.title,this.category=t.category,this.location=s,this.parent=e,this._startTime=t.startTime,this._result=i}titlePath(){var e;return[...((e=this.parent)==null?void 0:e.titlePath())||[],this.title]}get startTime(){return new Date(this._startTime)}set startTime(t){this._startTime=+t}get attachments(){var t,e;return((e=(t=this._endPayload)==null?void 0:t.attachments)==null?void 0:e.map(s=>this._result.attachments[s]))??[]}get annotations(){var t;return((t=this._endPayload)==null?void 0:t.annotations)??[]}}class le{constructor(t,e){this.parallelIndex=-1,this.workerIndex=-1,this.duration=-1,this.stdout=[],this.stderr=[],this.attachments=[],this.annotations=[],this.status="skipped",this.steps=[],this.errors=[],this._stepMap=new Map,this._startTime=0,this.retry=t,this._id=e}setStartTimeNumber(t){this._startTime=t}get startTime(){return new Date(this._startTime)}set startTime(t){this._startTime=+t}}const ce={forbidOnly:!1,fullyParallel:!1,globalSetup:null,globalTeardown:null,globalTimeout:0,grep:/.*/,grepInvert:null,maxFailures:0,metadata:{},preserveOutput:"always",projects:[],reporter:[[ne.CI?"dot":"list"]],reportSlowTests:{max:5,threshold:3e5},configFile:"",rootDir:"",quiet:!1,shard:null,tags:[],updateSnapshots:"missing",updateSourceMethod:"patch",runAgents:"none",version:"",workers:0,webServer:null};function lt(o){return o.map(t=>t.s!==void 0?t.s:new RegExp(t.r.source,t.r.flags))}function ue(o){let t=0,e=0,s=0;for(const i of o.results)i.status==="interrupted"||(i.status==="skipped"&&o.expectedStatus==="skipped"?++t:i.status==="skipped"||(i.status===o.expectedStatus?++e:++s));return e===0&&s===0?"skipped":s===0?"expected":e===0&&t===0?"unexpected":"flaky"}function de(o){return{status:o.status,startTime:new Date(o.startTime),duration:o.duration}}function he(o){return{...ce,...o}}class gt{constructor(t,e,s,i,a,r){this._treeItemById=new Map,this._treeItemByTestId=new Map;const m=i&&[...i.values()].some(Boolean);this.pathSeparator=a,this.rootItem={kind:"group",subKind:"folder",id:t,title:"",location:{file:"",line:0,column:0},duration:0,parent:void 0,children:[],status:"none",hasLoadErrors:!1},this._treeItemById.set(t,this.rootItem);const u=(f,l,w,x)=>{for(const c of x==="tests"?[]:l.suites){if(!c.title){u(f,c,w,"all");continue}let T=w.children.find(_=>_.kind==="group"&&_.title===c.title);T||(T={kind:"group",subKind:"describe",id:"suite:"+l.titlePath().join("")+""+c.title,title:c.title,location:c.location,duration:0,parent:w,children:[],status:"none",hasLoadErrors:!1},this._addChild(w,T)),u(f,c,T,"all")}for(const c of x==="suites"?[]:l.tests){const T=c.title;let _=w.children.find(E=>E.kind!=="group"&&E.title===T);_||(_={kind:"case",id:"test:"+c.titlePath().join(""),title:T,parent:w,children:[],tests:[],location:c.location,duration:0,status:"none",project:void 0,test:void 0,tags:c.tags},this._addChild(w,_));const b=c.results[0];let I="none";(b==null?void 0:b[G])==="scheduled"?I="scheduled":(b==null?void 0:b[G])==="running"?I="running":(b==null?void 0:b.status)==="skipped"?I="skipped":(b==null?void 0:b.status)==="interrupted"?I="none":b&&c.outcome()!=="expected"?I="failed":b&&c.outcome()==="expected"&&(I="passed"),_.tests.push(c);const j={kind:"test",id:c.id,title:f.name,location:c.location,test:c,parent:_,children:[],status:I,duration:c.results.length?Math.max(0,c.results[0].duration):0,project:f};this._addChild(_,j),this._treeItemByTestId.set(c.id,j),_.duration=_.children.reduce((E,R)=>E+R.duration,0)}};for(const f of(e==null?void 0:e.suites)||[])if(!(m&&!i.get(f.title)))for(const l of f.suites)if(r){if(u(f.project(),l,this.rootItem,"suites"),l.tests.length){const w=this._defaultDescribeItem();u(f.project(),l,w,"tests")}}else{const w=this._fileItem(l.location.file.split(a),!0);u(f.project(),l,w,"all")}for(const f of s){if(!f.location)continue;const l=this._fileItem(f.location.file.split(a),!0);l.hasLoadErrors=!0}}_addChild(t,e){t.children.push(e),e.parent=t,this._treeItemById.set(e.id,e)}filterTree(t,e,s){const i=t.trim().toLowerCase().split(" "),a=[...e.values()].some(Boolean),r=u=>{const f=[...u.tests[0].titlePath(),...u.tests[0].tags].join(" ").toLowerCase();return!i.every(l=>f.includes(l))&&!u.tests.some(l=>s==null?void 0:s.has(l.id))?!1:(u.children=u.children.filter(l=>!a||(s==null?void 0:s.has(l.test.id))||e.get(l.status)),u.tests=u.children.map(l=>l.test),!!u.children.length)},m=u=>{const f=[];for(const l of u.children)l.kind==="case"?r(l)&&f.push(l):(m(l),(l.children.length||l.hasLoadErrors)&&f.push(l));u.children=f};m(this.rootItem)}_fileItem(t,e){if(t.length===0)return this.rootItem;const s=t.join(this.pathSeparator),i=this._treeItemById.get(s);if(i)return i;const a=this._fileItem(t.slice(0,t.length-1),!1),r={kind:"group",subKind:e?"file":"folder",id:s,title:t[t.length-1],location:{file:s,line:0,column:0},duration:0,parent:a,children:[],status:"none",hasLoadErrors:!1};return this._addChild(a,r),r}_defaultDescribeItem(){let t=this._treeItemById.get("<anonymous>");return t||(t={kind:"group",subKind:"describe",id:"<anonymous>",title:"<anonymous>",location:{file:"",line:0,column:0},duration:0,parent:this.rootItem,children:[],status:"none",hasLoadErrors:!1},this._addChild(this.rootItem,t)),t}sortAndPropagateStatus(){Rt(this.rootItem)}flattenForSingleProject(){const t=e=>{e.kind==="case"&&e.children.length===1?(e.project=e.children[0].project,e.test=e.children[0].test,e.children=[],this._treeItemByTestId.set(e.test.id,e)):e.children.forEach(t)};t(this.rootItem)}shortenRoot(){let t=this.rootItem;for(;t.children.length===1&&t.children[0].kind==="group"&&t.children[0].subKind==="folder";)t=t.children[0];t.location=this.rootItem.location,this.rootItem=t}fileNames(){const t=new Set,e=s=>{s.kind==="group"&&s.subKind==="file"?t.add(s.id):s.children.forEach(e)};return e(this.rootItem),[...t]}flatTreeItems(){const t=[],e=s=>{t.push(s),s.children.forEach(e)};return e(this.rootItem),t}treeItemById(t){return this._treeItemById.get(t)}collectTestIds(t){return fe(t)}}function Rt(o){for(const r of o.children)Rt(r);o.kind==="group"&&o.children.sort((r,m)=>r.location.file.localeCompare(m.location.file)||r.location.line-m.location.line);let t=o.children.length>0,e=o.children.length>0,s=!1,i=!1,a=!1;for(const r of o.children)e=e&&r.status==="skipped",t=t&&(r.status==="passed"||r.status==="skipped"),s=s||r.status==="failed",i=i||r.status==="running",a=a||r.status==="scheduled";i?o.status="running":a?o.status="scheduled":s?o.status="failed":e?o.status="skipped":t&&(o.status="passed")}function fe(o){const t=new Set,e=new Set,s=i=>{if(i.kind!=="test"&&i.kind!=="case"){i.children.forEach(s);return}let a=i;for(;a&&a.parent&&!(a.kind==="group"&&a.subKind==="file");)a=a.parent;e.add(a.location.file),i.kind==="case"?i.tests.forEach(r=>t.add(r.id)):t.add(i.id)};return s(o),{testIds:t,locations:e}}const G=Symbol("statusEx");class pe{constructor(t){this.loadErrors=[],this.progress={total:0,passed:0,failed:0,skipped:0},this._lastRunTestCount=0,this._receiver=new pt(this._createReporter(),{mergeProjects:!0,mergeTestCases:!0,resolvePath:Tt(t.pathSeparator),clearPreviousResultsWhenTestBegins:!0}),this._options=t}_createReporter(){return{version:()=>"v2",onConfigure:t=>{this.config=t,this._lastRunReceiver=new pt({version:()=>"v2",onBegin:e=>{this._lastRunTestCount=e.allTests().length,this._lastRunReceiver=void 0}},{mergeProjects:!0,mergeTestCases:!1,resolvePath:Tt(this._options.pathSeparator)}),this._lastRunReceiver.dispatch({method:"onConfigure",params:{config:t}})},onBegin:t=>{var e;if(this.rootSuite||(this.rootSuite=t),this._testResultsSnapshot){for(const s of this.rootSuite.allTests())s.results=((e=this._testResultsSnapshot)==null?void 0:e.get(s.id))||s.results;this._testResultsSnapshot=void 0}this.progress.total=this._lastRunTestCount,this.progress.passed=0,this.progress.failed=0,this.progress.skipped=0,this._options.onUpdate(!0)},onEnd:()=>{this._options.onUpdate(!0)},onTestBegin:(t,e)=>{e[G]="running",this._options.onUpdate()},onTestEnd:(t,e)=>{t.outcome()==="skipped"?++this.progress.skipped:t.outcome()==="unexpected"?++this.progress.failed:++this.progress.passed,e[G]=e.status,this._options.onUpdate()},onError:t=>this._handleOnError(t),printsToStdio:()=>!1}}processGlobalReport(t){const e=new pt({version:()=>"v2",onConfigure:s=>{this.config=s},onError:s=>this._handleOnError(s)});for(const s of t)e.dispatch(s)}processListReport(t){var s;const e=((s=this.rootSuite)==null?void 0:s.allTests())||[];this._testResultsSnapshot=new Map(e.map(i=>[i.id,i.results])),this._receiver.reset();for(const i of t)this._receiver.dispatch(i)}processTestReportEvent(t){var e,s,i;(s=(e=this._lastRunReceiver)==null?void 0:e.dispatch(t))==null||s.catch(()=>{}),(i=this._receiver.dispatch(t))==null||i.catch(()=>{})}_handleOnError(t){var e,s;this.loadErrors.push(t),(s=(e=this._options).onError)==null||s.call(e,t),this._options.onUpdate()}asModel(){return{rootSuite:this.rootSuite||new Z("","root"),config:this.config,loadErrors:this.loadErrors,progress:this.progress}}}function Tt(o){return(t,e)=>{const s=[];for(const i of[...t.split(o),...e.split(o)]){const a=o==="\\"&&s.length===1&&s[0].endsWith(":"),r=!s.length;if(!(!i&&!r&&!a)&&i!=="."){if(i===".."){s.pop();continue}s.push(i)}}return s.join(o)}}const ge=({source:o})=>{const[t,e]=zt(),[s,i]=H.useState(Kt()),[a]=H.useState(Vt(()=>import("./assets/xtermModule-CsJ4vdCR.js"),__vite__mapDeps([0,1]),import.meta.url).then(m=>m.default)),r=H.useRef(null);return H.useEffect(()=>($t(i),()=>Ht(i)),[]),H.useEffect(()=>{const m=o.write,u=o.clear;return(async()=>{const{Terminal:f,FitAddon:l}=await a,w=e.current;if(!w)return;const x=s==="dark-mode"?_e:me;if(r.current&&r.current.terminal.options.theme===x)return;r.current&&(w.textContent="");const c=new f({convertEol:!0,fontSize:13,scrollback:1e4,fontFamily:"monospace",theme:x}),T=new l;c.loadAddon(T);for(const _ of o.pending)c.write(_);o.write=(_=>{o.pending.push(_),c.write(_)}),o.clear=()=>{o.pending=[],c.clear()},c.open(w),T.fit(),r.current={terminal:c,fitAddon:T}})(),()=>{o.clear=u,o.write=m}},[a,r,e,o,s]),H.useEffect(()=>{setTimeout(()=>{r.current&&(r.current.fitAddon.fit(),o.resize(r.current.terminal.cols,r.current.terminal.rows))},250)},[t,o]),n.jsx("div",{"data-testid":"output",className:"xterm-wrapper",style:{flex:"auto"},ref:e})},me={foreground:"#383a42",background:"#fafafa",cursor:"#383a42",black:"#000000",red:"#e45649",green:"#50a14f",yellow:"#c18401",blue:"#4078f2",magenta:"#a626a4",cyan:"#0184bc",white:"#a0a0a0",brightBlack:"#000000",brightRed:"#e06c75",brightGreen:"#98c379",brightYellow:"#d19a66",brightBlue:"#4078f2",brightMagenta:"#a626a4",brightCyan:"#0184bc",brightWhite:"#383a42",selectionBackground:"#d7d7d7",selectionForeground:"#383a42"},_e={foreground:"#f8f8f2",background:"#1e1e1e",cursor:"#f8f8f0",black:"#000000",red:"#ff5555",green:"#50fa7b",yellow:"#f1fa8c",blue:"#bd93f9",magenta:"#ff79c6",cyan:"#8be9fd",white:"#bfbfbf",brightBlack:"#4d4d4d",brightRed:"#ff6e6e",brightGreen:"#69ff94",brightYellow:"#ffffa5",brightBlue:"#d6acff",brightMagenta:"#ff92df",brightCyan:"#a4ffff",brightWhite:"#e6e6e6",selectionBackground:"#44475a",selectionForeground:"#f8f8f2"},ve=({filterText:o,setFilterText:t,statusFilters:e,setStatusFilters:s,projectFilters:i,setProjectFilters:a,testModel:r,runTests:m})=>{const[u,f]=d.useState(!1),l=d.useRef(null);d.useEffect(()=>{var c;(c=l.current)==null||c.focus()},[]);const w=[...e.entries()].filter(([c,T])=>T).map(([c])=>c).join(" ")||"all",x=[...i.entries()].filter(([c,T])=>T).map(([c])=>c).join(" ")||"all";return n.jsxs("div",{className:"filters",children:[n.jsx(qt,{expanded:u,setExpanded:f,title:n.jsx("input",{ref:l,type:"search",placeholder:"Filter (e.g. text, @tag)",spellCheck:!1,value:o,onChange:c=>{t(c.target.value)},onKeyDown:c=>{c.key==="Enter"&&m()}})}),n.jsxs("div",{className:"filter-summary",title:"Status: "+w+`
Projects: `+x,onClick:()=>f(!u),children:[n.jsx("span",{className:"filter-label",children:"Status:"})," ",w,n.jsx("span",{className:"filter-label",children:"Projects:"})," ",x]}),u&&n.jsxs("div",{className:"hbox",style:{marginLeft:14,maxHeight:200,overflowY:"auto"},children:[n.jsx("div",{className:"filter-list",role:"list","data-testid":"status-filters",children:[...e.entries()].map(([c,T])=>n.jsx("div",{className:"filter-entry",role:"listitem",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:T,onChange:()=>{const _=new Map(e);_.set(c,!_.get(c)),s(_)}}),n.jsx("div",{children:c})]})},c))}),n.jsx("div",{className:"filter-list",role:"list","data-testid":"project-filters",children:[...i.entries()].map(([c,T])=>n.jsx("div",{className:"filter-entry",role:"listitem",children:n.jsxs("label",{children:[n.jsx("input",{type:"checkbox",checked:T,onChange:()=>{var I;const _=new Map(i);_.set(c,!_.get(c)),a(_);const b=(I=r==null?void 0:r.config)==null?void 0:I.configFile;b&&yt.setObject(b+":projects",[..._.entries()].filter(([j,E])=>E).map(([j])=>j))}}),n.jsx("div",{children:c||"untitled"})]})},c))})]})]})},we=({tag:o,style:t,onClick:e})=>n.jsx("span",{className:mt("tag",`tag-color-${be(o)}`),onClick:e,style:{margin:"6px 0 0 6px",...t},title:`Click to filter by tag: ${o}`,children:o});function be(o){let t=0;for(let e=0;e<o.length;e++)t=o.charCodeAt(e)+((t<<8)-t);return Math.abs(t%6)}const xe=Yt,Se=({filterText:o,testModel:t,testServerConnection:e,testTree:s,runTests:i,runningState:a,watchAll:r,watchedTreeIds:m,setWatchedTreeIds:u,isLoading:f,onItemSelected:l,requestedCollapseAllCount:w,requestedExpandAllCount:x,setFilterText:c,onRevealSource:T})=>{const[_,b]=d.useState({expandedItems:new Map}),[I,j]=d.useState(),[E,R]=d.useState(w),[W,tt]=d.useState(x);d.useEffect(()=>{if(E!==w){_.expandedItems.clear();for(const k of s.flatTreeItems())_.expandedItems.set(k.id,!1);R(w),j(void 0),b({..._});return}if(W!==x){_.expandedItems.clear();for(const k of s.flatTreeItems())_.expandedItems.set(k.id,!0);tt(x),j(void 0),b({..._});return}if(!a||a.itemSelectedByUser)return;let h;const B=k=>{var M;k.children.forEach(B),!h&&k.status==="failed"&&(k.kind==="test"&&a.testIds.has(k.test.id)||k.kind==="case"&&a.testIds.has((M=k.tests[0])==null?void 0:M.id))&&(h=k)};B(s.rootItem),h&&j(h.id)},[a,j,s,E,R,w,W,tt,x,_,b]);const N=d.useMemo(()=>{if(I)return s.treeItemById(I)},[I,s]);d.useEffect(()=>{if(!t)return;const h=Te(N,t);let B;(N==null?void 0:N.kind)==="test"?B=N.test:(N==null?void 0:N.kind)==="case"&&N.tests.length===1&&(B=N.tests[0]),l({treeItem:N,testCase:B,testFile:h})},[t,N,l]),d.useEffect(()=>{if(!f)if(r)e==null||e.watchNoReply({fileNames:s.fileNames()});else{const h=new Set;for(const B of m.value){const k=s.treeItemById(B),M=k==null?void 0:k.location.file;M&&h.add(M)}e==null||e.watchNoReply({fileNames:[...h]})}},[f,s,r,m,e]);const $=h=>{j(h.id),i("bounce-if-busy",s.collectTestIds(h))},K=(h,B)=>{if(h.preventDefault(),h.stopPropagation(),h.metaKey||h.ctrlKey){const k=o.split(" ");k.includes(B)?c(k.filter(M=>M!==B).join(" ").trim()):c((o+" "+B).trim())}else c((o.split(" ").filter(k=>!k.startsWith("@")).join(" ")+" "+B).trim())};return n.jsx(xe,{name:"tests",treeState:_,setTreeState:b,rootItem:s.rootItem,dataTestId:"test-tree",render:h=>{const B=h.id.replace(/[^\w\d-_]/g,"-"),k=B+"-label",M=B+"-time";return n.jsxs("div",{className:"hbox ui-mode-tree-item","aria-labelledby":`${k} ${M}`,children:[n.jsxs("div",{id:k,className:"ui-mode-tree-item-title",children:[n.jsx("span",{children:h.title}),h.kind==="case"?h.tags.map(Y=>n.jsx(we,{tag:Y.slice(1),onClick:ct=>K(ct,Y)},Y)):null]}),!!h.duration&&h.status!=="skipped"&&n.jsx("div",{id:M,className:"ui-mode-tree-item-time",children:Xt(h.duration)}),n.jsxs(q,{noMinHeight:!0,noShadow:!0,children:[n.jsx(F,{icon:"play",title:"Run",onClick:()=>$(h),disabled:!!a&&!a.completed}),n.jsx(F,{icon:"go-to-file",title:"Show source",onClick:T,style:h.kind==="group"&&h.subKind==="folder"?{visibility:"hidden"}:{}}),!r&&n.jsx(F,{icon:"eye",title:"Watch",onClick:()=>{m.value.has(h.id)?m.value.delete(h.id):m.value.add(h.id),u({...m})},toggled:m.value.has(h.id)})]})]})},icon:h=>Qt(h.status),title:h=>h.title,selectedItem:N,onAccepted:$,onSelected:h=>{a&&(a.itemSelectedByUser=!0),j(h.id)},isError:h=>h.kind==="group"?h.hasLoadErrors:!1,autoExpandDepth:o?5:1,noItemsMessage:f?"Loading…":"No tests"})};function Te(o,t){if(!(!o||!t))return{file:o.location.file,line:o.location.line,column:o.location.column,source:{errors:t.loadErrors.filter(e=>{var s;return((s=e.location)==null?void 0:s.file)===o.location.file}).map(e=>({line:e.location.line,message:e.message})),content:void 0}}}function ke(o){return`.playwright-artifacts-${o}`}const je=({item:o,rootDir:t,onOpenExternally:e,revealSource:s,pathSeparator:i})=>{var w,x;const[a,r]=d.useState(void 0),[m,u]=d.useState(0),f=d.useRef(null),{outputDir:l}=d.useMemo(()=>({outputDir:o.testCase?Ie(o.testCase):void 0}),[o]);return d.useEffect(()=>{var b,I,j;f.current&&clearTimeout(f.current);const c=(b=o.testCase)==null?void 0:b.results[0];if(!c||((I=o.treeItem)==null?void 0:I.status)==="scheduled"){r(void 0);return}const T=c&&c.duration>=0&&c.attachments.find(E=>E.name==="trace");if(T&&T.path){kt(T.path,c.startTime.getTime()).then(E=>r({model:E,isLive:!1}));return}if(!l){r(void 0);return}const _=[l,ke(c.workerIndex),"traces",`${(j=o.testCase)==null?void 0:j.id}.json`].join(i);return f.current=setTimeout(async()=>{try{const E=await kt(_,Date.now());r({model:E,isLive:!0})}catch{const E=new Et("",[]);E.errorDescriptors.push(...c.errors.flatMap(R=>R.message?[{message:R.message}]:[])),r({model:E,isLive:!1})}finally{u(m+1)}},500),()=>{f.current&&clearTimeout(f.current)}},[l,o,r,m,u,i]),n.jsx(Jt,{model:a==null?void 0:a.model,showSourcesFirst:!0,rootDir:t,fallbackLocation:o.testFile,isLive:a==null?void 0:a.isLive,status:(w=o.treeItem)==null?void 0:w.status,annotations:((x=o.testCase)==null?void 0:x.annotations)??[],onOpenExternally:e,revealSource:s},"workbench")},Ie=o=>{var t;for(let e=o.parent;e;e=e.parent)if(e.project())return(t=e.project())==null?void 0:t.outputDir};async function kt(o,t){const e=`file?path=${encodeURIComponent(o)}&timestamp=${t}`,s=new URLSearchParams;s.set("trace",e);const a=await(await fetch(`contexts?${s.toString()}`)).json();return new Et(e,a)}let jt={cols:80};const z={pending:[],clear:()=>{},write:o=>z.pending.push(o),resize:()=>{}},A=new URLSearchParams(window.location.search),ye=new URL(A.get("server")??"../",window.location.href),_t=new URL(A.get("ws"),ye);_t.protocol=_t.protocol==="https:"?"wss:":"ws:";const P={args:A.getAll("arg"),grep:A.get("grep")||void 0,grepInvert:A.get("grepInvert")||void 0,projects:A.getAll("project"),workers:A.get("workers")||void 0,headed:A.has("headed"),updateSnapshots:A.get("updateSnapshots")||void 0,reporters:A.has("reporter")?A.getAll("reporter"):void 0,pathSeparator:A.get("pathSeparator")||"/"};P.updateSnapshots&&!["all","changed","none","missing"].includes(P.updateSnapshots)&&(P.updateSnapshots=void 0);const It=navigator.platform==="MacIntel";function Ee(o){return o.startsWith("/")&&(o=o.substring(1)),o.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}const Re=({})=>{var xt;const[o,t]=d.useState(""),[e,s]=d.useState(!1),[i,a]=d.useState(!1),[r,m]=d.useState(new Map([["passed",!1],["failed",!1],["skipped",!1]])),[u,f]=d.useState(new Map),[l,w]=d.useState(),[x,c]=d.useState(),[T,_]=d.useState({}),[b,I]=d.useState(!1),[j,E]=d.useState(),R=j&&!j.completed,[W,tt]=at("watch-all",!1),[N,$]=d.useState({value:new Set}),K=d.useRef(Promise.resolve()),h=d.useRef({testIds:new Set,locations:new Set}),[B,k]=d.useState(0),[M,Y]=d.useState(0),[ct,Ct]=d.useState(!1),[vt,wt]=d.useState(!0),[v,Bt]=d.useState(),[et,Pt]=d.useState(),[st,Nt]=d.useState(!1),[it,Lt]=d.useState(!1),[Dt,bt]=d.useState(!1),Mt=d.useCallback(()=>bt(!0),[bt]),[ut,Ft]=at("single-worker",!1),[dt,Ot]=at("updateSnapshots","missing"),[Q]=at("mergeFiles",!1),At=d.useRef(null),ot=d.useCallback(()=>{Bt(p=>(p==null||p.close(),new Zt(new Gt(_t))))},[]);d.useEffect(()=>{var p;(p=At.current)==null||p.focus(),I(!0),ot()},[ot]),d.useEffect(()=>{if(!v)return;const p=[v.onStdio(g=>{if(g.buffer){const S=atob(g.buffer);z.write(S)}else z.write(g.text);g.type==="stderr"&&a(!0)}),v.onClose(()=>Ct(!0))];return z.resize=(g,S)=>{jt={cols:g,rows:S},v.resizeTerminalNoReply({cols:g,rows:S})},()=>{for(const g of p)g.dispose()}},[v]),d.useEffect(()=>{if(!v)return;let p;const g=new pe({onUpdate:S=>{clearTimeout(p),p=void 0,S?w(g.asModel()):p||(p=setTimeout(()=>{w(g.asModel())},250))},onError:S=>{z.write((S.stack||S.value||"")+`
`),a(!0)},pathSeparator:P.pathSeparator});return Pt(g),w(void 0),I(!0),$({value:new Set}),(async()=>{try{await v.initialize({interceptStdio:!0,watchTestDirs:!0});const{status:S,report:C}=await v.runGlobalSetup({});if(g.processGlobalReport(C),S!=="passed")return;const L=await v.listTests({projects:P.projects,locations:P.args,grep:P.grep,grepInvert:P.grepInvert});g.processListReport(L.report),v.onReport(V=>{g.processTestReportEvent(V)});const{hasBrowsers:O}=await v.checkBrowsers({});wt(O)}finally{I(!1)}})(),()=>{clearTimeout(p)}},[v]),d.useEffect(()=>{if(!l)return;const{config:p,rootSuite:g}=l,S=p.configFile?yt.getObject(p.configFile+":projects",void 0):void 0,C=new Map(u);for(const L of C.keys())g.suites.find(O=>O.title===L)||C.delete(L);for(const L of g.suites)C.has(L.title)||C.set(L.title,!!(S!=null&&S.includes(L.title)));!S&&C.size&&![...C.values()].includes(!0)&&C.set(C.entries().next().value[0],!0),(u.size!==C.size||[...u].some(([L,O])=>C.get(L)!==O))&&f(C)},[u,l]),d.useEffect(()=>{R&&(l!=null&&l.progress)?c(l.progress):l||c(void 0)},[l,R]);const{testTree:nt}=d.useMemo(()=>{if(!l)return{testTree:new gt("",new Z("","root"),[],u,P.pathSeparator,Q)};const p=new gt("",l.rootSuite,l.loadErrors,u,P.pathSeparator,Q);return p.filterTree(o,r,R?j==null?void 0:j.testIds:void 0),p.sortAndPropagateStatus(),p.shortenRoot(),p.flattenForSingleProject(),{testTree:p}},[o,l,r,u,j,R,Q]),X=d.useCallback((p,g)=>{if(!(!v||!l)&&!(p==="bounce-if-busy"&&R)){for(const S of g.testIds)h.current.testIds.add(S);for(const S of g.locations)h.current.locations.add(S);K.current=K.current.then(async()=>{var O,V,U;const{testIds:S,locations:C}=h.current;if(h.current={testIds:new Set,locations:new Set},!S.size)return;{for(const y of((O=l.rootSuite)==null?void 0:O.allTests())||[])if(S.has(y.id)){y.results=[];const D=y._createTestResult("pending");D[G]="scheduled"}w({...l})}const L="  ["+new Date().toLocaleTimeString()+"]";z.write("\x1B[2m—".repeat(Math.max(0,jt.cols-L.length))+L+"\x1B[22m"),c({total:0,passed:0,failed:0,skipped:0}),E({testIds:S}),await v.runTests({locations:[...C].map(Ee),grep:P.grep,grepInvert:P.grepInvert,testIds:[...S],projects:[...u].filter(([y,D])=>D).map(([y])=>y),updateSnapshots:dt,reporters:P.reporters,workers:ut?1:void 0,trace:"on"});for(const y of((V=l.rootSuite)==null?void 0:V.allTests())||[])((U=y.results[0])==null?void 0:U.duration)===-1&&(y.results=[]);w({...l}),E(y=>y?{...y,completed:!0}:void 0)})}},[u,R,l,v,dt,ut]),rt=d.useCallback(()=>X("bounce-if-busy",nt.collectTestIds(nt.rootItem)),[X,nt]);d.useEffect(()=>{if(!v||!et)return;const p=v.onTestFilesChanged(async g=>{if(K.current=K.current.then(async()=>{I(!0);try{const U=await v.listTests({projects:P.projects,locations:P.args,grep:P.grep,grepInvert:P.grepInvert});et.processListReport(U.report)}catch(U){console.log(U)}finally{I(!1)}}),await K.current,g.testFiles.length===0)return;const S=et.asModel(),C=new gt("",S.rootSuite,S.loadErrors,u,P.pathSeparator,Q),L=[],O=[],V=new Set(g.testFiles);if(W){const U=y=>{const D=y.location.file;if(D&&V.has(D)){const J=C.collectTestIds(y);L.push(...J.locations),O.push(...J.testIds)}y.kind==="group"&&y.subKind==="folder"&&y.children.forEach(U)};U(C.rootItem)}else for(const U of N.value){const y=C.treeItemById(U);if(!y)continue;let D=y;for(;!(D.kind==="group"&&(D.subKind==="file"||D.subKind==="folder"))&&D.parent;)D=D.parent;const J=D==null?void 0:D.location.file;if(J&&V.has(J)){const St=C.collectTestIds(y);L.push(...St.locations),O.push(...St.testIds)}}X("queue-if-busy",{locations:L,testIds:O})});return()=>p.dispose()},[X,v,W,N,et,u,Q]),d.useEffect(()=>{if(!v)return;const p=g=>{g.code==="Backquote"&&g.ctrlKey?(g.preventDefault(),s(!e)):g.code==="F5"&&g.shiftKey?(g.preventDefault(),v==null||v.stopTestsNoReply({})):g.code==="F5"&&(g.preventDefault(),rt())};return addEventListener("keydown",p),()=>{removeEventListener("keydown",p)}},[rt,ot,v,e]);const ht=d.useRef(null),Ut=d.useCallback(p=>{var g;p.preventDefault(),p.stopPropagation(),(g=ht.current)==null||g.showModal()},[]),ft=d.useCallback(p=>{var g;p.preventDefault(),p.stopPropagation(),(g=ht.current)==null||g.close()},[]),Wt=d.useCallback(p=>{ft(p),s(!0),v==null||v.installBrowsers({}).then(async()=>{s(!1);const{hasBrowsers:g}=await(v==null?void 0:v.checkBrowsers({}));wt(g)})},[ft,v]);return n.jsxs("div",{className:"vbox ui-mode",children:[!vt&&n.jsxs("dialog",{ref:ht,children:[n.jsxs("div",{className:"title",children:[n.jsx("span",{className:"codicon codicon-lightbulb"}),"Install browsers"]}),n.jsxs("div",{className:"body",children:["Playwright did not find installed browsers.",n.jsx("br",{}),"Would you like to run `playwright install`?",n.jsx("br",{}),n.jsx("button",{className:"button",onClick:Wt,children:"Install"}),n.jsx("button",{className:"button secondary",onClick:ft,children:"Dismiss"})]})]}),ct&&n.jsxs("div",{className:"disconnected",children:[n.jsx("div",{className:"title",children:"UI Mode disconnected"}),n.jsxs("div",{children:[n.jsx("a",{href:"#",onClick:()=>window.location.href="/",children:"Reload the page"})," to reconnect"]})]}),n.jsx(te,{sidebarSize:250,minSidebarSize:150,orientation:"horizontal",sidebarIsFirst:!0,settingName:"testListSidebar",main:n.jsxs("div",{className:"vbox",children:[n.jsxs("div",{className:mt("vbox",!e&&"hidden"),children:[n.jsxs(q,{children:[n.jsx("div",{className:"section-title",style:{flex:"none"},children:"Output"}),n.jsx(F,{icon:"circle-slash",title:"Clear output",onClick:()=>{z.clear(),a(!1)}}),n.jsx("div",{className:"spacer"}),n.jsx(F,{icon:"close",title:"Close",onClick:()=>s(!1)})]}),n.jsx(ge,{source:z})]}),n.jsx("div",{className:mt("vbox",e&&"hidden"),children:n.jsx(je,{pathSeparator:P.pathSeparator,item:T,rootDir:(xt=l==null?void 0:l.config)==null?void 0:xt.rootDir,revealSource:Dt,onOpenExternally:p=>v==null?void 0:v.openNoReply({location:{file:p.file,line:p.line,column:p.column}})})})]}),sidebar:n.jsxs("div",{className:"vbox ui-mode-sidebar",children:[n.jsxs(q,{noShadow:!0,noMinHeight:!0,children:[n.jsx("img",{src:"playwright-logo.svg",alt:"Playwright logo"}),n.jsx("div",{className:"section-title",children:"Playwright"}),n.jsx(F,{icon:"refresh",title:"Reload",onClick:()=>ot(),disabled:R||b}),n.jsxs("div",{style:{position:"relative"},children:[n.jsx(F,{icon:"terminal",title:"Toggle output — "+(It?"⌃`":"Ctrl + `"),toggled:e,onClick:()=>{s(!e)}}),i&&n.jsx("div",{title:"Output contains error",style:{position:"absolute",top:2,right:2,width:7,height:7,borderRadius:"50%",backgroundColor:"var(--vscode-notificationsErrorIcon-foreground)"}})]}),!vt&&n.jsx(F,{icon:"lightbulb-autofix",style:{color:"var(--vscode-list-warningForeground)"},title:"Playwright browsers are missing",onClick:Ut})]}),n.jsx(ve,{filterText:o,setFilterText:t,statusFilters:r,setStatusFilters:m,projectFilters:u,setProjectFilters:f,testModel:l,runTests:rt}),n.jsxs(q,{className:"section-toolbar",noMinHeight:!0,children:[!R&&!x&&n.jsx("div",{className:"section-title",children:"Tests"}),!R&&x&&n.jsx("div",{"data-testid":"status-line",className:"status-line",children:n.jsxs("div",{children:[x.passed,"/",x.total," passed (",x.passed/x.total*100|0,"%)"]})}),R&&x&&n.jsx("div",{"data-testid":"status-line",className:"status-line",children:n.jsxs("div",{children:["Running ",x.passed,"/",j.testIds.size," passed (",x.passed/j.testIds.size*100|0,"%)"]})}),n.jsx(F,{icon:"play",title:"Run all — F5",onClick:rt,disabled:R||b}),n.jsx(F,{icon:"debug-stop",title:"Stop — "+(It?"⇧F5":"Shift + F5"),onClick:()=>v==null?void 0:v.stopTests({}),disabled:!R||b}),n.jsx(F,{icon:"eye",title:"Watch all",toggled:W,onClick:()=>{$({value:new Set}),tt(!W)}}),n.jsx(F,{icon:"collapse-all",title:"Collapse all",onClick:()=>{k(B+1)}}),n.jsx(F,{icon:"expand-all",title:"Expand all",onClick:()=>{Y(M+1)}})]}),n.jsx(Se,{filterText:o,testModel:l,testTree:nt,testServerConnection:v,runningState:j,runTests:X,onItemSelected:_,watchAll:W,watchedTreeIds:N,setWatchedTreeIds:$,isLoading:b,requestedCollapseAllCount:B,requestedExpandAllCount:M,setFilterText:t,onRevealSource:Mt}),n.jsxs(q,{noShadow:!0,noMinHeight:!0,className:"settings-toolbar",onClick:()=>Lt(!it),children:[n.jsx("span",{className:`codicon codicon-${it?"chevron-down":"chevron-right"}`,style:{marginLeft:5},title:it?"Hide Testing Options":"Show Testing Options"}),n.jsx("div",{className:"section-title",children:"Testing Options"})]}),it&&n.jsx(ee,{settings:[{type:"check",value:ut,set:Ft,name:"Single worker"},{type:"select",options:[{label:"All",value:"all"},{label:"Changed",value:"changed"},{label:"Missing",value:"missing"},{label:"None",value:"none"}],value:dt,set:Ot,name:"Update snapshots"}]}),n.jsxs(q,{noShadow:!0,noMinHeight:!0,className:"settings-toolbar",onClick:()=>Nt(!st),children:[n.jsx("span",{className:`codicon codicon-${st?"chevron-down":"chevron-right"}`,style:{marginLeft:5},title:st?"Hide Settings":"Show Settings"}),n.jsx("div",{className:"section-title",children:"Settings"})]}),st&&n.jsx(se,{location:"ui-mode"})]})})]})};(async()=>{if(ie(),window.location.protocol!=="file:"){if(window.location.href.includes("isUnderTest=true")&&await new Promise(o=>setTimeout(o,1e3)),!navigator.serviceWorker)throw new Error(`Service workers are not supported.
Make sure to serve the website (${window.location}) via HTTPS or localhost.`);navigator.serviceWorker.register("sw.bundle.js"),navigator.serviceWorker.controller||await new Promise(o=>{navigator.serviceWorker.oncontrollerchange=()=>o()}),setInterval(function(){fetch("ping")},1e4)}oe.createRoot(document.querySelector("#root")).render(n.jsx(Re,{}))})();
